<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microservicio de Cuentas - Cooperativa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .results {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .results h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        #output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            max-height: 500px;
            overflow-y: auto;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        .info {
            color: #17a2b8;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            word-break: break-all;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-active {
            background: #d1ecf1;
            color: #0c5460;
        }

        .json-view {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .api-info {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .api-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .api-info p {
            color: #666;
        }

        .api-info a {
            color: #764ba2;
            text-decoration: none;
            font-weight: bold;
        }

        .api-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ Microservicio de Cuentas - Cooperativa</h1>
        
        <div class="api-info">
            <h3>üì° API en ejecuci√≥n</h3>
            <p>Base URL: <strong>http://localhost:3000</strong></p>
            <p>Documentaci√≥n Swagger: <a href="http://localhost:3000/api-docs" target="_blank">http://localhost:3000/api-docs</a></p>
        </div>

        <div class="grid">
            <!-- Crear Cuenta -->
            <div class="card">
                <h2>‚ûï Crear Cuenta</h2>
                <form id="createForm">
                    <div class="form-group">
                        <label>ID del Socio:</label>
                        <input type="text" id="createSocioId" placeholder="socio-123" required>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Cuenta:</label>
                        <input type="text" id="createNumeroCuenta" placeholder="001-123456789" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Cuenta:</label>
                        <select id="createTipoCuenta" required>
                            <option value="AHORRO">AHORRO</option>
                            <option value="CORRIENTE">CORRIENTE</option>
                            <option value="PLAZO_FIJO">PLAZO FIJO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Saldo Inicial:</label>
                        <input type="number" id="createSaldo" placeholder="1000.00" step="0.01" min="0" required>
                    </div>
                    <button type="submit">Crear Cuenta</button>
                </form>
            </div>

            <!-- Buscar Cuenta por ID -->
            <div class="card">
                <h2>üîç Buscar Cuenta por ID</h2>
                <form id="getByIdForm">
                    <div class="form-group">
                        <label>ID de la Cuenta:</label>
                        <input type="text" id="getCuentaId" placeholder="UUID de la cuenta" required>
                    </div>
                    <button type="submit">Buscar</button>
                </form>
            </div>

            <!-- Buscar Cuentas por Socio -->
            <div class="card">
                <h2>üë§ Buscar Cuentas por Socio</h2>
                <form id="getBySocioForm">
                    <div class="form-group">
                        <label>ID del Socio:</label>
                        <input type="text" id="getSocioId" placeholder="socio-123" required>
                    </div>
                    <button type="submit">Buscar Cuentas</button>
                </form>
            </div>

            <!-- Listar Todas las Cuentas -->
            <div class="card">
                <h2>üìã Listar Todas las Cuentas</h2>
                <button onclick="getAllCuentas()">Ver Todas las Cuentas</button>
            </div>

            <!-- Realizar Dep√≥sito -->
            <div class="card">
                <h2>üí∞ Realizar Dep√≥sito</h2>
                <form id="depositForm">
                    <div class="form-group">
                        <label>ID de la Cuenta:</label>
                        <input type="text" id="depositCuentaId" placeholder="UUID de la cuenta" required>
                    </div>
                    <div class="form-group">
                        <label>Monto a Depositar:</label>
                        <input type="number" id="depositMonto" placeholder="500.00" step="0.01" min="0.01" required>
                    </div>
                    <button type="submit">Realizar Dep√≥sito</button>
                </form>
            </div>

            <!-- Realizar Retiro -->
            <div class="card">
                <h2>üèß Realizar Retiro</h2>
                <form id="withdrawForm">
                    <div class="form-group">
                        <label>ID de la Cuenta:</label>
                        <input type="text" id="withdrawCuentaId" placeholder="UUID de la cuenta" required>
                    </div>
                    <div class="form-group">
                        <label>Monto a Retirar:</label>
                        <input type="number" id="withdrawMonto" placeholder="200.00" step="0.01" min="0.01" required>
                    </div>
                    <button type="submit">Realizar Retiro</button>
                </form>
            </div>

            <!-- Actualizar Cuenta -->
            <div class="card">
                <h2>‚úèÔ∏è Actualizar Cuenta</h2>
                <form id="updateForm">
                    <div class="form-group">
                        <label>ID de la Cuenta:</label>
                        <input type="text" id="updateCuentaId" placeholder="UUID de la cuenta" required>
                    </div>
                    <div class="form-group">
                        <label>ID del Socio:</label>
                        <input type="text" id="updateSocioId" placeholder="socio-123" required>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Cuenta:</label>
                        <input type="text" id="updateNumeroCuenta" placeholder="001-123456789" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Cuenta:</label>
                        <select id="updateTipoCuenta" required>
                            <option value="AHORRO">AHORRO</option>
                            <option value="CORRIENTE">CORRIENTE</option>
                            <option value="PLAZO_FIJO">PLAZO FIJO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Saldo:</label>
                        <input type="number" id="updateSaldo" placeholder="1000.00" step="0.01" min="0" required>
                    </div>
                    <button type="submit">Actualizar</button>
                </form>
            </div>

            <!-- Eliminar Cuenta -->
            <div class="card">
                <h2>üóëÔ∏è Eliminar Cuenta</h2>
                <form id="deleteForm">
                    <div class="form-group">
                        <label>ID de la Cuenta:</label>
                        <input type="text" id="deleteCuentaId" placeholder="UUID de la cuenta" required>
                    </div>
                    <button type="submit" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">Eliminar Cuenta</button>
                </form>
            </div>
        </div>

        <!-- Resultados -->
        <div class="results">
            <h2>üìä Resultados</h2>
            <div id="output">Esperando operaci√≥n...</div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        function displayResult(data, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = type === 'error' ? 'status-error' : 'status-success';
            
            let html = `<div style="margin-bottom: 15px;">
                <span class="${statusClass} status-badge">${type.toUpperCase()}</span>
                <span style="margin-left: 10px; color: #666;">${timestamp}</span>
            </div>`;

            if (type === 'error') {
                html += `<div class="json-view">${JSON.stringify(data, null, 2)}</div>`;
            } else if (Array.isArray(data)) {
                if (data.length === 0) {
                    html += `<p style="color: #666; padding: 20px; text-align: center;">No se encontraron resultados</p>`;
                } else {
                    html += createTable(data);
                }
            } else if (typeof data === 'object' && data !== null) {
                // Respuesta de operaci√≥n √∫nica (crear, actualizar, obtener una cuenta, etc.)
                if (data.id) {
                    html += createTable([data]);
                } else {
                    html += `<div class="json-view">${JSON.stringify(data, null, 2)}</div>`;
                }
            } else {
                html += `<div class="json-view">${JSON.stringify(data, null, 2)}</div>`;
            }

            output.innerHTML = html;
        }

        function createTable(data) {
            if (!data || data.length === 0) return '';

            const keys = Object.keys(data[0]);
            
            let table = '<table><thead><tr>';
            keys.forEach(key => {
                table += `<th>${formatHeader(key)}</th>`;
            });
            table += '</tr></thead><tbody>';

            data.forEach(row => {
                table += '<tr>';
                keys.forEach(key => {
                    table += `<td>${formatValue(key, row[key])}</td>`;
                });
                table += '</tr>';
            });

            table += '</tbody></table>';
            return table;
        }

        function formatHeader(key) {
            const headers = {
                'id': 'ID',
                'socioId': 'ID Socio',
                'numeroCuenta': 'N√∫mero de Cuenta',
                'tipoCuenta': 'Tipo',
                'saldo': 'Saldo',
                'estado': 'Estado',
                'activo': 'Activo',
                'fechaCreacion': 'Fecha Creaci√≥n',
                'fechaActualizacion': 'Fecha Actualizaci√≥n'
            };
            return headers[key] || key;
        }

        function formatValue(key, value) {
            if (value === null || value === undefined) {
                return '<span style="color: #999;">N/A</span>';
            }

            if (key === 'saldo') {
                return `$${parseFloat(value).toFixed(2)}`;
            }

            if (key === 'estado') {
                const statusClass = value === 'ACTIVA' ? 'status-active' : 'status-error';
                return `<span class="${statusClass} status-badge">${value}</span>`;
            }

            if (key === 'activo') {
                const statusClass = value ? 'status-success' : 'status-error';
                const text = value ? 'S√ç' : 'NO';
                return `<span class="${statusClass} status-badge">${text}</span>`;
            }

            if (key === 'fechaCreacion' || key === 'fechaActualizacion') {
                return new Date(value).toLocaleString('es-ES');
            }

            if (key === 'id' && typeof value === 'string' && value.length > 20) {
                return `<small style="font-family: monospace;">${value}</small>`;
            }

            return value;
        }

        async function makeRequest(url, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(url, options);
                
                // Si es 204 No Content (DELETE exitoso), mostrar mensaje de √©xito
                if (response.status === 204) {
                    displayResult({ message: 'Cuenta eliminada exitosamente' }, 'success');
                    return;
                }

                const data = await response.json();

                if (response.ok) {
                    displayResult(data, 'success');
                } else {
                    displayResult(data, 'error');
                }
            } catch (error) {
                displayResult({ error: error.message }, 'error');
            }
        }

        // Crear Cuenta
        document.getElementById('createForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const body = {
                socioId: document.getElementById('createSocioId').value,
                numeroCuenta: document.getElementById('createNumeroCuenta').value,
                tipoCuenta: document.getElementById('createTipoCuenta').value,
                saldo: parseFloat(document.getElementById('createSaldo').value)
            };
            await makeRequest(`${API_URL}/cuentas`, 'POST', body);
        });

        // Buscar por ID
        document.getElementById('getByIdForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('getCuentaId').value;
            await makeRequest(`${API_URL}/cuentas/${id}`);
        });

        // Buscar por Socio
        document.getElementById('getBySocioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const socioId = document.getElementById('getSocioId').value;
            await makeRequest(`${API_URL}/cuentas/socio/${socioId}`);
        });

        // Listar todas
        async function getAllCuentas() {
            await makeRequest(`${API_URL}/cuentas`);
        }

        // Dep√≥sito
        document.getElementById('depositForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('depositCuentaId').value;
            const monto = parseFloat(document.getElementById('depositMonto').value);
            await makeRequest(`${API_URL}/cuentas/${id}/deposito`, 'POST', { monto });
        });

        // Retiro
        document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('withdrawCuentaId').value;
            const monto = parseFloat(document.getElementById('withdrawMonto').value);
            await makeRequest(`${API_URL}/cuentas/${id}/retiro`, 'POST', { monto });
        });

        // Actualizar
        document.getElementById('updateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('updateCuentaId').value;
            const body = {
                socioId: document.getElementById('updateSocioId').value,
                numeroCuenta: document.getElementById('updateNumeroCuenta').value,
                tipoCuenta: document.getElementById('updateTipoCuenta').value,
                saldo: parseFloat(document.getElementById('updateSaldo').value)
            };
            await makeRequest(`${API_URL}/cuentas/${id}`, 'PUT', body);
        });

        // Eliminar
        document.getElementById('deleteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('deleteCuentaId').value;
            if (confirm('¬øEst√°s seguro de eliminar esta cuenta?')) {
                await makeRequest(`${API_URL}/cuentas/${id}`, 'DELETE');
            }
        });
    </script>
</body>
</html>
